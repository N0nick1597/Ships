#include <iostream>
#include <fstream>
#include <string>
#include <cstring>
#include <cstdlib>
#include <ctime>
#include <stdlib.h>
using namespace std;
int const Cmax=11;
class player{
	private:
		int health;
	protected:
		string **CBOARD;//Kompiuterio lentele su laivais
		int LETTERS[Cmax], let;
		int NUMBERS[Cmax], numb;
		int DIRECTION[Cmax], dir;
		int DIRECT[Cmax], direc;
		string letter;
		int shoot;
		int lett;
		int count;
	public:
		player(){
			health=10;
			CBOARD= new string*[Cmax];
			for(int i=0; i<Cmax; i++){
				CBOARD[i]=new string[Cmax];
			}
			for(int i=0; i<10; i++){
				for(int j=0; j<10; j++){
					CBOARD[i][j]="+";
				}
			}
		}
		/*void boardprinting(string BOARD[10][10]){
			string l [10]={"A", "B", "C", "D", "E", "F", "G", "H", "I", "J"};
			for(int i=0; i<10; i++){
				if(i!=0){
					cout<<endl;	
				}
				if(i==0){
					cout<<"   ";
					for(int i=0; i<10; i++){
						cout<<l[i]<<" ";
					}
					cout<<endl;
				}
				for(int j=0; j<10; j++){
					if(j==0){
						if(a==9){
						cout<<"10 ";
					}
					else{
						a++;
						cout<<a<<"  ";
					}
					}
					else{
					BOARD[i][j]="+";
					cout<<BOARD[i][j]<< " ";
					}
				}
			}
		}*/
		void randoms(){
			int LETTERS[10]={0, 1, 2, 3, 4, 5, 6, 7, 8, 9};
			let=LETTERS[rand()%10];
			//////////////////////////////////////////////////////// Raidziu random		
			int NUMBERS[10]={0, 1, 2, 3, 4, 5, 6, 7, 8, 9};
			numb=NUMBERS[rand()%10];
			/////////////////////////////////////////////////////// Skaiciu random
			int DIRECTION[5]={4, 1, 2, 3, 4};
			dir=DIRECTION[rand()%4 + 1];
			//////////////////////////////////////////////////////  Krypties random 1- desine, 2- kaire, 3- virsus, 4-apacia
			int DIRECT[2]={1, 3 };
			direc=DIRECT[rand()%2];
		}
		void randomships(int n){
			int ind = n;
			randoms();
			if(direc==1){
				if(let+n-1<=9&&checking(n, direc, CBOARD, numb+1, let+1)){
					for(int i=let; i<let+n; i++){
						if(CBOARD[numb][i]!="O"){
							CBOARD[numb][i]="O";
						}
						else{
						randoms();
						randomships(ind);
						}
					}
				}
				else{
					randoms();
					randomships(ind);
					
				}
			}
			if(direc==3){
				if(numb+n-1<=9&&checking(n, direc, CBOARD, numb+1, let+1)){
					for(int j=numb; j<numb+n; j++){
						if(CBOARD[j][let]!="O"){
							CBOARD[j][let]="O";
						}
						else{
						randoms();
			            randomships(ind);
						}
					}
				}
				else{
				randoms();
				randomships(ind);
				}
			}
			cout<<endl;
	}
	void shooting(){
			show(CBOARD);
			cout<<endl;
			cout<<"iveskite koordinate i kuria norite sauti"<<endl;
			cin>>letter>>shoot;
			convert(letter);
			cout<<endl;
			if(CBOARD[shoot-1][getlett()]=="O"){
				CBOARD[shoot-1][getlett()]="X";
				cout<<"Pataikete!"<<endl;
				health--;
			}
			else{
				CBOARD[shoot-1][getlett()]="-";
				cout<<endl;
				cout<<"nepataikete"<<endl;
			}
		}
		int returnhealth(){
			return health;
		}
		void show(string **BOARD){
			string l [10]={"A", "B", "C", "D", "E", "F", "G", "H", "I", "J"};
			int a=0;
			for(int i=0; i<10; i++){
				if(i!=0){
					cout<<endl;	
				}
				if(i==0){
					cout<<"   ";
					for(int q=0.; q<10; q++){
						cout<<l[q]<<" ";
					}
					cout<<endl;
				}
				for(int j=0; j<10; j++){
					if(j==0){
						if(a==9){
						cout<<"10 ";
					}
					else{
						a++;
						cout<<a<<"  ";
					}
					}
					cout<<BOARD[i][j]<<" ";
				}
			}
		}
		convert(string letter){
			if(letter=="A"){
				lett=0;
			}
			else if(letter=="B"){
				lett=1;
			}
			else if(letter=="C"){
				lett=2;
			}
			else if(letter=="D"){
				lett=3;
			}
			else if(letter=="E"){
				lett=4;
			}
			else if(letter=="F"){
				lett=5;
			}
			else if(letter=="G"){
				lett=6;
			}
			else if(letter=="H"){
				lett=7;
			}
			else if(letter=="I"){
				lett=8;
			}
			else if(letter=="J"){
				lett=9;
			}
		}
		int getlett(){
			return lett;
		}
			bool checking(int n, int dir, string **BOARD, int numb, int let){
				if(dir==1){
					for(int i=let; i<let+n; i++){
						if (BOARD[numb-1][i]=="O"){
							return false;
						}
						else{
							return true;
						}
					}
				}
				else if(dir==2){
					for(int i=let; i>let-n; i--){
						if(BOARD[numb-1][i]=="O"){
							return false;
						}
						else{
							return true;
						}
					}
				}
				else if(dir==3){
					for(int i=numb; i<numb+n; i++){
						if(BOARD[i-1][let]=="O"){
							return false;
						}
						else{
							return true;
						}
					}
				}
				else if(dir==4){
					for(int i=numb; i>numb-n; i--){
						if(BOARD[i-1][let]=="O"){
							return false;
						}
						else{
							return true;
						}
					}
				}
		}
		~player(){
			for(int i=0; i<Cmax; i++){
				delete CBOARD[i];
			}
			delete [] CBOARD;
		}
	};
/**************************************************************************************************************************************************************************/
class computer: public player{
	private:
		int a;
		int number;
		int direction;
		int health1;
	protected:
	    int lett;
		string letter;
		string **PBOARD;// zaidejo lentele su laivais
		int shoot;
	public:
		computer(){
			health1=10;
			PBOARD= new string*[Cmax];
			for(int i=0; i<Cmax; i++){
				PBOARD[i]=new string[Cmax];
			}
			for(int i=0; i<10; i++){
				for(int j=0; j<10; j++){
					PBOARD[i][j]="+";
				}
			}
		}
		void ships(int size){ 
			cout<<endl;
			cout<<"iveskite laivo krypti (1- desine, 2- kaire, 3- apacia, 4- virsus)"<<endl;
			cin>>direction;
			cout<<"Iveskite laivo pradine koordinate, pvz: A 5"<<endl;
			cin>>letter>>number;
			convert(letter);
			if(direction==1){
				for(int i=getlett(); i<getlett()+size; i++){
					PBOARD[number-1][i]="O";
				}
				//show(PBOARD);
			}
			else if(direction==2){
				for(int i=getlett(); i>getlett()-size; i--){
					PBOARD[number-1][i]="O";
				}
				//show(PBOARD);
			}
			else if(direction==3){
				for(int i=number; i<number+size; i++){
					PBOARD[i-1][getlett()]="O";
				}
				//show(PBOARD);
			}
			else if(direction==4){
				for(int i=number; i>number-size; i--){
					PBOARD[i-1][getlett()]="O";
				}
				//show(PBOARD);
			}
			for(int i=0; i<=9; i++){
				for(int j=0; j<=9; j++){
					if(PBOARD[i][j]!="O"){
						PBOARD[i][j]="+";
					}
				}
			}
			system("CLS");
			cout<<endl;
			show(PBOARD);
		}
		void randomshooting(){
			randoms();
			if(PBOARD[let][numb]=="O"){
				PBOARD[let][numb]="X";
				//smartshooting();
				health1--;
			}
			else if(PBOARD[let][numb]=="X"){
				PBOARD[let][numb]="X";
			}
			else{
				PBOARD[let][numb]="-";
			}
			show(PBOARD);
		}
		int returnhealth1(){
			return health1;
		}
		void smartshooting(){
			if(count==1){
				if(PBOARD[numb-1][let+1]=="O"){
					PBOARD[numb-1][let+1]="X";
					for(int i=let+2; i<let+4; i++){
						PBOARD[numb-1][i]="O";
						if(PBOARD[numb-1][i]!="O"){
							break;
							count=0;
							randomshooting();
						}
						else{
							if(PBOARD[numb-1][let+1]!="O"){
								PBOARD[numb-1][let+1]="-";
								randomshooting();
							}
							count=2;
							//atiduodam ejima
						}
						}
				}
			}
			else if(count==2){
				if(PBOARD[numb-1][let-1]=="O"){
					PBOARD[numb-1][let-1]="X";
					for(int i=let-2; i>let-4; i--){
					PBOARD[numb-1][i]="O";
						if(PBOARD[numb-1][i]!="O"){
							break;
							count=0;
							randomshooting();
						}
						else{
							if(PBOARD[numb-1][let-1]!="O"){
								PBOARD[numb-1][let-1]="-";
								randomshooting();
							}
							count=3;
							//atiduodam ejima
						}
					}
				}
			}
			else if(count==3){
				if(PBOARD[numb-1][let+1]=="O"){
					PBOARD[numb-1][let+1]="X";
					for(int i=numb+2; i<numb+4; i++){
					PBOARD[i-1][let]="O";
						if(PBOARD[i-1][let]!="O"){
							break;
							count=0;
							randomshooting();
						}
						else{
							if(PBOARD[numb-1][let+1]!="O"){
								PBOARD[numb-1][let+1]="-";
								randomshooting();
							}
							count=4;
							//atiduodam ejima
						}
					}
				}
			}	
			else if(count==4){
				if(PBOARD[numb-1][let+1]=="O"){
					PBOARD[numb-1][let+1]="X";
					for(int i=numb-2; i>numb-4; i--){
					PBOARD[i-1][let]="O";
						if(PBOARD[i-1][let]!="O"){
							break;
							count=0;
							randomshooting();
						}
						else{
							if(PBOARD[numb-1][let+1]!="O"){
								PBOARD[numb-1][let+1]="-";
								randomshooting();
							}
							count=4;
							//atiduodam ejima
						}
					}
				}
			}
		}
	~computer(){
			for(int i=0; i<Cmax; i++){
				delete PBOARD[i];
			}
			delete [] PBOARD;
		}
};
/***************************************************************************************************************************************************************************/
int main(){
	srand (time(NULL));
	string CBOARD[10][10], PBOARD[10][10];
	player A;
	computer B;
	////////////////////////////////////////
	//cout<<"Zaidejo zemelapis"<<endl;	////
	//A.boardprinting(PBOARD);			////
	//cout<<endl;							////
	//cout<<"----------------------";		////		Zemelapiu isspausdinimas i ekrana
	//cout<<endl;;						////
	//cout<<"Kompiuterio zemelapis"<<endl;////
	//B.boardprinting(CBOARD);			////
	////////////////////////////////////////
	//cout<<endl;
	A.randomships(4);
	A.randomships(3);
	A.randomships(2);
	A.randomships(1);
	B.ships(4);
	B.ships(3);
	B.ships(2);
	B.ships(1);
	system("CLS");
	while(A.returnhealth()!=0||B.returnhealth1()!=0){
		cout<<"ZAIDEJO BOARD"<<endl;	
		B.randomshooting();	
		cout<<endl;
		cout<<"-------------------------------------------------------"<<endl;
		cout<<"KOMPIUTERIO BOARD"<<endl;
		A.shooting();
		system("CLS");
		if(A.returnhealth()==0){
			cout<<"Jus laimejote.";
			cout<<endl;
			system("pause");
			return 0;
		}
		else if(B.returnhealth1()==0){
			cout<<"Kompiuteris laimejo.";
			cout<<endl;
			system("pause");
			return 0;
		}
	}
	//cout<<endl;
	//cout<<endl;
	//B.shooting();
	//cout<<endl;
	/*for(int i=0; i<5; i++){
		cout<<endl;
		B.randomshooting();
	}*/
	return 0;
}
